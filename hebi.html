<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Hebi</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        canvas {
            position: absolute
        }

        .mycan {
            width: 800px;
            height: 480px;
        }

        #hebican {
            z-index: 3
        }

        #canvas {
            z-index: 2
        }

        #myCanvas {
            z-index: 1
        }
    </style>
    <script>

        function cinit() {
            clock();
            setInterval(clock, 1000);
        }
        function clock() {
            var now = new Date();
            var ctx = document.getElementById('canvas').getContext('2d');
            ctx.save();
            ctx.clearRect(0, 0, 150, 150);
            ctx.translate(75, 75);
            ctx.scale(0.4, 0.4);
            ctx.rotate(-Math.PI / 2);
            ctx.strokeStyle = "black";
            ctx.fillStyle = "white";
            ctx.lineWidth = 8;
            ctx.lineCap = "round";

            // Hour marks
            ctx.save();
            for (var i = 0; i < 12; i++) {
                ctx.beginPath();
                ctx.rotate(Math.PI / 6);
                ctx.moveTo(100, 0);
                ctx.lineTo(120, 0);
                ctx.stroke();
            }
            ctx.restore();

            // Minute marks
            ctx.save();
            ctx.lineWidth = 5;
            for (i = 0; i < 60; i++) {
                if (i % 5 != 0) {
                    ctx.beginPath();
                    ctx.moveTo(117, 0);
                    ctx.lineTo(120, 0);
                    ctx.stroke();
                }
                ctx.rotate(Math.PI / 30);
            }
            ctx.restore();

            var sec = now.getSeconds();
            var min = now.getMinutes();
            var hr = now.getHours();
            hr = hr >= 12 ? hr - 12 : hr;

            ctx.fillStyle = "black";

            // write Hours
            ctx.save();
            ctx.rotate(hr * (Math.PI / 6) + (Math.PI / 360) * min + (Math.PI / 21600) * sec)
            ctx.lineWidth = 14;
            ctx.beginPath();
            ctx.moveTo(-20, 0);
            ctx.lineTo(80, 0);
            ctx.stroke();
            ctx.restore();

            // write Minutes
            ctx.save();
            ctx.rotate((Math.PI / 30) * min + (Math.PI / 1800) * sec)
            ctx.lineWidth = 10;
            ctx.beginPath();
            ctx.moveTo(-28, 0);
            ctx.lineTo(112, 0);
            ctx.stroke();
            ctx.restore();

            // Write seconds
            ctx.save();
            ctx.rotate(sec * Math.PI / 30);
            ctx.strokeStyle = "#D40000";
            ctx.fillStyle = "#D40000";
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(-30, 0);
            ctx.lineTo(83, 0);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(0, 0, 10, 0, Math.PI * 2, true);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(95, 0, 10, 0, Math.PI * 2, true);
            ctx.stroke();
            ctx.fillStyle = "#555";
            ctx.arc(0, 0, 3, 0, Math.PI * 2, true);
            ctx.fill();
            ctx.restore();

            ctx.beginPath();
            ctx.lineWidth = 14;
            ctx.strokeStyle = '#325FA2';
            ctx.arc(0, 0, 142, 0, Math.PI * 2, true);
            ctx.stroke();

            ctx.restore();
        }
        var x = 0, y = 0;
        var dir = 0;
        function hebiGame(bgctx, hebictx) {
            var gripw = 20, startX = 10, startY = 10, wnum = 39, hnum = 23;
            makeMap = function (ctx, startX, startY, gripw, wnum, hnum) {
                ctx.strokeStyle = 'orange';
                var ty = startY, tx = startX;
                for (var i = 0; i < wnum; i++) {
                    ctx.strokeRect(tx, ty, gripw, gripw * hnum);
                    tx += gripw;
                }

                tx = startX;
                for (var i = 0; i < hnum; i++) {
                    ctx.strokeRect(tx, ty, gripw * wnum, gripw);
                    ty += gripw;
                }
            }
            bgctx.fillStyle = "#CFDFFF";
            bgctx.fillRect(0, 0, 800, 600);
            makeMap(bgctx, startX, startY, gripw, wnum, hnum);

            addBlk = function (x, y) {
                ctx.save();
                ctx.fillStyle = "#66BA98";
                ctx.fillRect(startX + x * gripw, startY + y * gripw, gripw, gripw);
                ctx.restore();
            }
            delBlk = function (x, y) {
                ctx.clearRect(startX + x * gripw, startY + y * gripw, gripw, gripw);
            }
            var ctx = hebictx;
            addBlk(0, 0);
            var x = 0, y = 0;
            var go = [{x: 1, y: 0}, {x: -1, y: 0}, {x: 0, y: -1}, {x: 0, y: 1}];
            var hebiStep = function () {
                var nx = x;
                var ny = y;
                nx += go[dir].x;
                ny += go[dir].y;
                nx = (nx + wnum) % wnum;
                ny = (ny + hnum) % hnum;
                if ((nx < 0) || (ny < 0) || (nx >= wnum) || (ny >= hnum))return;
                else {
                    delBlk(x, y);
                    x = nx;
                    y = ny;
                    addBlk(x, y);
                }
            }
            hebiStep();
            setInterval(hebiStep, 500);

        }
        function hebiInit(ctx) {
            sbiStep(ctx);
            setInterval(sbiStep, 200, ctx);
        }
        function sbiStep(ctx) {
            ctx.restore();
            ctx.save();
            ctx.fillStyle = '#00FF00';
            ctx.fillRect(20 * x, y, 10, 10);
            x++;
//            console.log(ctx);
        }
        var inputType = {
            right: false,
            up: false,
            left: false,
            down: false,
            quit: false
        };

        function keyInput(keyDown, event) {
            console.log(keyDown, event);
            var KEY = {
                D: 68,
                W: 87,
                A: 65,
                S: 83,
                RIGHT: 39,
                UP: 38,
                LEFT: 37,
                DOWN: 40,
                Q: 81
            };
            var keynum;
            var keychar;
            var numcheck;

            if (window.event) // IE
            {
                keynum = event.keyCode
            }
            else if (event.which) // Netscape/Firefox/Opera
            {
                keynum = event.which
            }
            function press(code) {
                switch (code) {
                    case KEY.RIGHT:
                    case KEY.D:
                        inputType.right = true;
                        break;

                    case KEY.UP:
                    case KEY.W:
                        inputType.up = true;
                        break;

                    case KEY.LEFT:
                    case KEY.A:
                        inputType.left = true;
                        break;

                    case KEY.DOWN:
                    case KEY.S:
                        inputType.down = true;
                        break;

                    case KEY.Q:
                        inputType.quit = true;
                        break;
                }
            }

            function release(code) {
                switch (code) {
                    case KEY.RIGHT:
                    case KEY.D:
                        inputType.right = false;
                        break;

                    case KEY.UP:
                    case KEY.W:
                        inputType.up = false;
                        break;

                    case KEY.LEFT:
                    case KEY.A:
                        inputType.left = false;
                        break;

                    case KEY.DOWN:
                    case KEY.S:
                        inputType.down = false;
                        break;

                    case KEY.Q:
                        inputType.quit = false;
                        break;

                    default:
                        console.log('unrecognized key code: ' + code);
                        break;
                }
            }

            if (keyDown)press(keynum);
            else release(keynum);

            if (inputType.right)dir = 0;
            else if (inputType.left)dir = 1;
            else if (inputType.up)dir = 2;
            else if (inputType.down)dir = 3;

            //console.log(inputType);
            return false;
        }
    </script>
</head>
<body onkeydown="return keyInput(true,event)" onkeyup="return keyInput(false,event)">
<div class="container">
    <div class="row">
        <div class="col-md-12">
            <canvas class="mycan" id="myCanvas" width="800" height="480"
                    ></canvas>
            <canvas class="mycan" id="canvas" width="800" height="480"
                    ></canvas>
            <canvas class="mycan" id="hebican" width="800" height="480"
                    ></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <p id="warnWords"></p>
        </div>
    </div>

</div>
<!-- /.container -->

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jquery.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>
<script>
    var canvas = $("#myCanvas")[0];
    if (!canvas.getContext) {
        $("#warnWords").html("浏览器不支持canvas,请使用Chrome浏览器.");
    }
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = '#CFDFEF';
    ctx.fillRect(0, 0, 300, 1000);
    ctx.fillStyle = '#000000';

    var i = 0;
    while (i < 100) {
        ctx.fillRect(15 * i, 0, 10, 10);
        i++;
    }
    var hebictx = $("#hebican")[0].getContext('2d');
    hebiGame(ctx, hebictx);
    hebiInit($("#hebican")[0].getContext('2d'));
    cinit();
</script>
</body>
</html>